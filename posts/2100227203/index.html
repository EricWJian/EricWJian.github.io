<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>SpringSecurity | Eric</title><meta name="author" content="Eric"><meta name="copyright" content="Eric"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="视频地址: session 管理 一、框架简介1、概要Spring 是非常流行和成功的 Java 应用开发框架，SpringSecurity 正是 Spring 家族中的成员。SpringSecurity 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。 正如你可能知道的关"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://ericwjian.github.io/posts/2100227203/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4dfa2c883c8c4c23f4866185de932236";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'SpringSecurity',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-09-21 09:23:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">98</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Eric"><span class="site-name">Eric</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">SpringSecurity</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-09-09T16:00:00.000Z" title="发表于 2020-09-10 00:00:00">2020-09-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-21T01:23:51.439Z" title="更新于 2023-09-21 09:23:51">2023-09-21</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A4%E8%AF%81%E6%8E%88%E6%9D%83/">认证授权</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">8.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>33分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="SpringSecurity"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><hr>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV15a411A7kP">视频地址:</a></p>
<p><a href="/posts/385996612/">session 管理</a></p>
<h1 id="一、框架简介"><a href="#一、框架简介" class="headerlink" title="一、框架简介"></a>一、框架简介</h1><h2 id="1、概要"><a href="#1、概要" class="headerlink" title="1、概要"></a>1、概要</h2><p>Spring 是非常流行和成功的 Java 应用开发框架，SpringSecurity 正是 Spring 家族中的成员。SpringSecurity 基于 Spring 框架，提供了一套 Web 应用安全性的完整解决方案。</p>
<p>正如你可能知道的关于安全方面的两个主要区域是 <code>认证</code> 和 <code>授权</code>（或者访问控制），一般来说，Web 应用的安全性包括 <code>用户认证</code>（Authentication）和 <code>用户授权</code>（Authorization）两个部分，这两点也是 Spring Security 重要核心功能。</p>
<blockquote>
<p>用户认证：指的是验证某个用户是否为系统中的合法主体，也就是说用户能否访问该系统。用户认证一般要求用户提供用户名和密码。系统通过校验用户名和密码来完成认证过程。<code>通俗点说就是系统认为用户是否能登录</code></p>
</blockquote>
<blockquote>
<p>用户授权：指的是验证某个用户是否有权限执行某个操作。在一个系统中，不同用户所具有的权限是不同的。比如对一个文件来说，有的用户只能进行读取，而有的用户可以进行修改。一般来说，系统会为不同的用户分配不同的角色，而每个角色则对应一系列的权限。<code>通俗点讲就是系统判断用户是否有权限去做某些事情</code>。</p>
</blockquote>
<h2 id="2、同款产品对比"><a href="#2、同款产品对比" class="headerlink" title="2、同款产品对比"></a>2、同款产品对比</h2><h3 id="1-Spring-Security"><a href="#1-Spring-Security" class="headerlink" title="1.Spring Security"></a>1.Spring Security</h3><p>Spring 技术栈的组成部分。通过提供完整可扩展的认证和授权支持保护你的应用程序。<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-security">https://spring.io/projects/spring-security</a></p>
<p>SpringSecurity特点：</p>
<ul>
<li>和 Spring 无缝整合。</li>
<li>全面的权限控制。</li>
<li>专门为 Web 开发而设计。<ul>
<li>旧版本不能脱离Web 环境使用。</li>
<li>新版本对整个框架进行了分层抽取，分成了核心模块和Web 模块。单独引入核心模块就可以脱离Web 环境。</li>
</ul>
</li>
<li>重量级。(需要大量的引入其他组件)</li>
</ul>
<h3 id="2-Shiro"><a href="#2-Shiro" class="headerlink" title="2.Shiro"></a>2.Shiro</h3><p>Apache 旗下的轻量级权限控制框架。</p>
<p>Shiro 特点：</p>
<ul>
<li><p>轻量级。Shiro 主张的理念是把复杂的事情变简单。针对对性能有更高要求的互联网应用有更好表现。</p>
</li>
<li><p>通用性。</p>
<ul>
<li>好处：不局限于Web 环境，可以脱离 Web 环境使用。</li>
<li>缺陷：在Web 环境下一些特定的需求需要手动编写代码定制。</li>
</ul>
</li>
</ul>
<p>Spring Security 是 Spring家族中的一个安全管理框架，实际上，在 Spring Boot 出现之前，Spring Security 就已经发展了多年了，但是使用的并不多，安全管理这个领域，一直是 Shiro 的天下。</p>
<p>相对于 Shiro，在 SSM 中整合Spring Security 都是比较麻烦的操作，所以，SpringSecurity 虽然功能比Shiro 强大，但是使用反而没有 Shiro 多（Shiro 虽然功能没有Spring Security 多，但是对于大部分项目而言，Shiro 也够用了）。</p>
<p>自从有了 Spring Boot 之后，Spring Boot 对于 Spring Security 提供了自动化配置方案，可以使用更少的配置来使用 SpringSecurity。因此，一般来说，常见的安全管理技术栈的组合是这样的：</p>
<ul>
<li>SSM + Shiro</li>
<li>Spring Boot/Spring Cloud + SpringSecurity</li>
</ul>
<p><strong>以上只是一个推荐的组合而已，如果单纯从技术上来说，无论怎么组合，都是可以运行的。</strong></p>
<h2 id="3、权限管理中的相关概念"><a href="#3、权限管理中的相关概念" class="headerlink" title="3、权限管理中的相关概念"></a>3、权限管理中的相关概念</h2><h3 id="1-主体"><a href="#1-主体" class="headerlink" title="1.主体"></a>1.主体</h3><p>英文单词：principal</p>
<p>使用系统的用户或设备或从其他系统远程登录的用户等等。简单说就是谁使用系统谁就是主体。</p>
<h3 id="2-认证"><a href="#2-认证" class="headerlink" title="2.认证"></a>2.认证</h3><p>英文单词：authentication</p>
<p>权限管理系统确认一个主体的身份，允许主体进入系统。简单说就是“主体”证 明自己是谁。 笼统的认为就是以前所做的登录操作。</p>
<h3 id="3-授权"><a href="#3-授权" class="headerlink" title="3.授权"></a>3.授权</h3><p>英文单词：authorization</p>
<p>将操作系统的 “<code>权力</code>” “<code>授予</code>” “<code>主体</code>”，这样主体就具备了操作系统中特定功 能的能力。 所以简单来说，授权就是给用户分配权限。</p>
<h1 id="二、入门案例"><a href="#二、入门案例" class="headerlink" title="二、入门案例"></a>二、入门案例</h1><p>使用 IDEA 中 Spring Initializr 创建一个 springBoot项目</p>
<h2 id="1、POM-文件"><a href="#1、POM-文件" class="headerlink" title="1、POM 文件"></a>1、POM 文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="2、controller"><a href="#2、controller" class="headerlink" title="2、controller"></a>2、controller</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">Hello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello SpringSecurity-01!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello SpringSecurity-01&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h2><p>访问 localhost:8081/hello</p>
<p><code>默认认证使用的是 form 表单的模式</code>，认证模式有两种，basic 和 form 模式。</p>
<img src="/posts/2100227203/image-20210925155138384.png" class="" title="image-20210925155138384">

<p>默认的用户名：user</p>
<p>密码在项目启动的时候在控制台会打印，注意每次启动的时候密码都回发生变化！</p>
<img src="/posts/2100227203/image-20210925155214903.png" class="" title="image-20210925155214903">

<p>输入用户名，密码，这样表示可以访问了。</p>
<img src="/posts/2100227203/image-20211011114511853.png" class="" title="image-20211011114511853">





<h1 id="三、两个重要的接口"><a href="#三、两个重要的接口" class="headerlink" title="三、两个重要的接口"></a>三、两个重要的接口</h1><p><code>SpringSecurity 中有两个重要的接口  UserDetailsService，PasswordEncoder</code></p>
<h2 id="1、UserDetailsService"><a href="#1、UserDetailsService" class="headerlink" title="1、UserDetailsService"></a>1、UserDetailsService</h2><p>当什么也没有配置的时候，账号和密码是由 Spring Security 定义生成的。而在实际项目中账号和密码都是从数据库中查询出来的。 所以我们要通过自定义逻辑控制认证逻辑。</p>
<p>如果需要自定义逻辑时，只需要实现 UserDetailsService 接口即可。接口定义如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.security.core.userdetails;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Locates the user based on the username. In the actual implementation, the search</span></span><br><span class="line"><span class="comment">    * may possibly be case sensitive, or case insensitive depending on how the</span></span><br><span class="line"><span class="comment">    * implementation instance is configured. In this case, the &lt;code&gt;UserDetails&lt;/code&gt;</span></span><br><span class="line"><span class="comment">    * object that comes back may have a username that is of a different case than what</span></span><br><span class="line"><span class="comment">    * was actually requested..</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> username the username identifying the user whose data is required.</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span> a fully populated user record (never &lt;code&gt;null&lt;/code&gt;)</span></span><br><span class="line"><span class="comment">    * <span class="doctag">@throws</span> UsernameNotFoundException if the user could not be found or the user has no</span></span><br><span class="line"><span class="comment">    * GrantedAuthority</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>返回值 UserDetails</strong> 对象</p>
<p>这个类是系统默认的用户”<strong>主体</strong>“</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDetails</span> <span class="keyword">extends</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// 表示获取登录用户所有权限</span></span><br><span class="line">    Collection&lt;? <span class="keyword">extends</span> <span class="title class_">GrantedAuthority</span>&gt; getAuthorities();</span><br><span class="line">    <span class="comment">// 表示获取密码</span></span><br><span class="line">    String <span class="title function_">getPassword</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 表示获取用户名</span></span><br><span class="line">    String <span class="title function_">getUsername</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 表示判断账户是否过期</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAccountNonExpired</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 表示判断账户是否被锁定</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAccountNonLocked</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 表示凭证&#123;密码&#125;是否过期</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCredentialsNonExpired</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// 表示当前用户是否可用</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isEnabled</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以下是 UserDetails 实现类 ctrl+alt+b</p>
<img src="/posts/2100227203/image-20210925161901954.png" class="" title="image-20210925161901954">

<p>以后我们只需要使用 User 这个实体类即可!</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Calls the more complex constructor with all boolean arguments set to &#123;<span class="doctag">@code</span> true&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String username, String password, Collection&lt;? extends GrantedAuthority&gt; authorities)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>(username, password, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, <span class="literal">true</span>, authorities);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>方法参数 username:</p>
<p>表示用户名。此值是客户端表单传递过来的数据。默认情况下必须叫 username，否则无 法接收。</p>
<h2 id="2、PasswordEncoder"><a href="#2、PasswordEncoder" class="headerlink" title="2、PasswordEncoder"></a>2、PasswordEncoder</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PasswordEncoder</span> &#123;</span><br><span class="line">    <span class="comment">// 表示把参数按照特定的解析规则进行解析</span></span><br><span class="line">    String <span class="title function_">encode</span><span class="params">(CharSequence rawPassword)</span>;</span><br><span class="line">    <span class="comment">// 表示验证从存储中获取的编码密码与编码后提交的原始密码是否匹配。如果密码匹配，则返回 true；如果不匹配，则返回 false。第一个参数表示需要被解析的密码。第二个参数表示存储的密码。</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(CharSequence rawPassword, String encodedPassword)</span>;</span><br><span class="line">    <span class="comment">// 表示如果解析的密码能够再次进行解析且达到更安全的结果则返回 true，否则返回 false。默认返回 false。</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">upgradeEncoding</span><span class="params">(String encodedPassword)</span> &#123;</span><br><span class="line">  	  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口实现类:</p>
<img src="/posts/2100227203/image-20210925163012835.png" class="" title="image-20210925163012835">

<p><strong>BCryptPasswordEncoder 是 Spring Security 官方推荐的密码解析器，平时多使用这个解析器。</strong></p>
<p><strong>BCryptPasswordEncoder 是对 bcrypt 强散列方法的具体实现。是基于 Hash 算法实现的单向加密。可以通过 strength 控制加密强度，默认 10.</strong></p>
<p>查用方法演示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 创建密码解析器</span></span><br><span class="line">    <span class="type">BCryptPasswordEncoder</span> <span class="variable">bCryptPasswordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    <span class="comment">// 对密码进行加密</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">atguigu</span> <span class="operator">=</span> bCryptPasswordEncoder.encode(<span class="string">&quot;atguigu&quot;</span>);</span><br><span class="line">    <span class="comment">// 打印加密之后的数据</span></span><br><span class="line">    System.out.println(<span class="string">&quot;加密之后数据：\t&quot;</span>+atguigu);</span><br><span class="line">    <span class="comment">//判断原字符加密后和加密之前是否匹配</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> bCryptPasswordEncoder.matches(<span class="string">&quot;atguigu&quot;</span>, atguigu);</span><br><span class="line">    <span class="comment">// 打印比较结果</span></span><br><span class="line">    System.out.println(<span class="string">&quot;比较结果：\t&quot;</span>+result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="四、SecurityConfig-配置"><a href="#四、SecurityConfig-配置" class="headerlink" title="四、SecurityConfig 配置"></a>四、SecurityConfig 配置</h1><h2 id="1、HttpSecurity配置列表"><a href="#1、HttpSecurity配置列表" class="headerlink" title="1、HttpSecurity配置列表"></a>1、HttpSecurity配置列表</h2><p>Spring Security 中的 <code>httpSecurity</code> 配置可以用来保护 Web 应用程序，包括认证、授权、会话管理等重要功能。其常用配置包括：</p>
<ol>
<li><code>authorizeRequests()</code> 方法：通过该方法定义安全规则，限定 URL 访问权限。</li>
<li><code>formLogin()</code> 方法：启用默认的基于表单的身份验证，自动生成登录页面、处理表单提交。</li>
<li><code>logout()</code> 方法：配置注销（登出）功能。</li>
<li><code>csrf()</code> 方法：启用 CSRF（跨站点请求伪造）防护功能，避免攻击者利用已登录用户的凭据发送请求。</li>
<li><code>requestCache()</code> 方法：配置请求缓存机制，使成功验证后跳转到原始请求的页面。</li>
<li><code>sessionManagement()</code> 方法：配置会话管理器，防止会话固定攻击、并发登录等安全问题。</li>
</ol>
<p>还有很多其他的配置选项，具体使用需视情况而定。</p>
<ol>
<li><p>openldLogin()：用于基于 Openld 的脸证。</p>
</li>
<li><p>headers()：将安全标头添加到响应。</p>
</li>
<li><p>cors()：配置跨域资源共享(CORS)。</p>
</li>
<li><p>sessionManagement()：允许配置会话管理。</p>
</li>
<li><p>portMapper()：允许配置一个PortMapper(HttpSecurity#(getSharedObject(class)))，其他提供SecurityConfigurer的对象使用 PortMapper 从 HTTP 重定向到 HTTPS 或者从 HTTPS 重定向到 HTTP。默认情况下，Spring Security使用一个PortMapperImpl映射 HTTP 端口8080到 HTTPS 端口8443，HTTP 端口80到 HTTPS 端口443。</p>
</li>
<li><p>jee()：配置基于容器的预认证。 在这种情况下，认证由Servlet容器管理</p>
</li>
<li><p>x509()：配置基于x509的认证</p>
</li>
<li><p>rememberMe：允许配置“记住我”的验证</p>
</li>
<li><p>authorizeRequests()：允许基于使用HttpServletRequest限制访问</p>
</li>
<li><p>requestCache()：允许配置请求缓存</p>
</li>
<li><p>exceptionHandling() 允许配置错误处理</p>
</li>
<li><p>securityContext() 在HttpServletRequests之间的SecurityContextHolder上设置SecurityContext的管理。 当使用WebSecurityConfigurerAdapter时，这将自动应用</p>
</li>
<li><p>servletApi() 将HttpServletRequest方法与在其上找到的值集成到SecurityContext中。 当使用WebSecurityConfigurerAdapter时，这将自动应用</p>
</li>
<li><p>csrf() 添加 CSRF 支持，使用WebSecurityConfigurerAdapter时，默认启用</p>
</li>
<li><p>logout() 添加退出登录支持。当使用WebSecurityConfigurerAdapter时，这将自动应用。默认情况是，访问URL”/ logout”，使HTTP Session无效来清除用户，清除已配置的任何#rememberMe()身份验证，清除SecurityContextHolder，然后重定向到”/login?success”</p>
</li>
<li><p>anonymous() 允许配置匿名用户的表示方法。 当与WebSecurityConfigurerAdapter结合使用时，这将自动应用。 默认情况下，匿名用户将使用org.springframework.security.authentication.AnonymousAuthenticationToken表示，并包含角色 “ROLE_ANONYMOUS”</p>
</li>
<li><p>formLogin() 指定支持基于表单的身份验证。如果未指定FormLoginConfigurer#loginPage(String)，则将生成默认登录页面</p>
</li>
<li><p>oauth2Login() 根据外部OAuth 2.0或OpenID Connect 1.0提供程序配置身份验证</p>
</li>
<li><p>requiresChannel() 配置通道安全。为了使该配置有用，必须提供至少一个到所需信道的映射</p>
</li>
<li><p>httpBasic() 配置 Http Basic 验证</p>
</li>
<li><p>addFilterAt() 在指定的Filter类的位置添加过滤器</p>
</li>
</ol>
<h2 id="2、authorizeRequests-对url进行控制"><a href="#2、authorizeRequests-对url进行控制" class="headerlink" title="2、authorizeRequests() 对url进行控制"></a>2、authorizeRequests() 对url进行控制</h2><p>授权的方式包括 <code>web授权</code>和<code>方法授权</code>，<code>web授权</code>是通过 url 拦截进行授权，<code>方法授权</code>是通过方法拦截进行授权。他们都会调用 accessDecisionManager 进行授权决策，若为web授权，则拦截器为FilterSecurityInterceptor；若为方法授权，则拦截器为 MethodSecurityInterceptor。如果同时通过web授权和方法授权，则先执行 web授权，再执行方法授权，最后如果决策通过，则允许访问资源，否则将禁止访问。</p>
<ol>
<li>anyRequest()：表示匹配所有的请求。一般情况下此方法都会使用，设置全部内容都需要进行认证，会放在最后。</li>
<li>permitAll() 方法，所有用户可访问。</li>
<li>denyAll() 方法，所有用户不可访问。</li>
<li>authenticated() 方法，登录用户可访问。</li>
<li>hasRole(String role) 限制单个角色访问，角色将被增加<code>ROLE_</code> .所以<code>ADMIN</code>将和<code>ROLE_ADMIN</code>进行比较.</li>
<li>hasAnyRole(String… roles)允许多个角色访问.</li>
<li>hasAuthority(String authority) 限制单个权限访问</li>
<li>hasAnyAuthority(String… authorities) 允许多个权限访问.</li>
<li>access(String attribute) 该方法使用 SpEL表达式, 所以可以创建复杂的限制.</li>
<li>hasIpAddress(String ipaddressExpression) 限制IP地址或子网</li>
</ol>
<h2 id="3、登录"><a href="#3、登录" class="headerlink" title="3、登录"></a>3、登录</h2><ol>
<li>formLogin()：基于表单登录</li>
<li>loginPage()：登录页</li>
<li>loginProcessingUrl()：登录跳转地址，需和表单提交地址一致。</li>
<li>defaultSuccessUrl()：登录成功后的默认处理页</li>
<li>failuerHandler()：登录失败之后的处理器</li>
<li>successHandler()：登录成功之后的处理器</li>
<li>failuerUrl()：登录失败之后系统转向的url，默认是this.loginPage + “?error”</li>
</ol>
<h2 id="4、退出"><a href="#4、退出" class="headerlink" title="4、退出"></a>4、退出</h2><ol>
<li>logoutUrl：登出url ， 默认是/logout， 它可以是一个ant path url。</li>
</ol>
<h2 id="5、自定-403-无权访问规则"><a href="#5、自定-403-无权访问规则" class="headerlink" title="5、自定 403 无权访问规则"></a>5、自定 403 无权访问规则</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理器和跳转页面，二者选其一就行</span></span><br><span class="line">http.exceptionHandling()</span><br><span class="line">        .accessDeniedHandler(<span class="keyword">new</span> <span class="title class_">MyAccessDeniedHandler</span>()) <span class="comment">// 无权限处理器</span></span><br><span class="line">        .accessDeniedPage(<span class="string">&quot;/unauth&quot;</span>);<span class="comment">// 无权限跳转页面</span></span><br></pre></td></tr></table></figure>

<p>Spring Security 支持自定义权限受限处理，需要 实现 AccessDeniedHandler接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAccessDeniedHandler</span> <span class="keyword">implements</span> <span class="title class_">AccessDeniedHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);</span><br><span class="line">        httpServletResponse.setHeader(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">        <span class="type">PrintWriter</span> <span class="variable">out</span> <span class="operator">=</span> httpServletResponse.getWriter();</span><br><span class="line">        out.write(<span class="string">&quot;&#123;\&quot;status\&quot;:\&quot;error\&quot;,\&quot;msg\&quot;:\&quot;权限不足，请联系管理员！\&quot;&#125;&quot;</span>);</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="五、Web-权限方案"><a href="#五、Web-权限方案" class="headerlink" title="五、Web 权限方案"></a>五、Web 权限方案</h1><h2 id="1、设置账号、密码"><a href="#1、设置账号、密码" class="headerlink" title="1、设置账号、密码"></a>1、设置账号、密码</h2><h3 id="1、方式一"><a href="#1、方式一" class="headerlink" title="1、方式一"></a>1、方式一</h3><p>在 application.properties 指定 账号和密码</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">wj</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<h3 id="2、方式二"><a href="#2、方式二" class="headerlink" title="2、方式二"></a>2、方式二</h3><p>自定义实现配置类，在自定义配置类中 指定 账号和密码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">BCryptPasswordEncoder</span> <span class="variable">passwordEncoder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">encode</span> <span class="operator">=</span> passwordEncoder.encode(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line">        auth.inMemoryAuthentication().withUser(<span class="string">&quot;wangjian&quot;</span>).password(encode).roles(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">getPasswordEncoder</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、方式三"><a href="#3、方式三" class="headerlink" title="3、方式三"></a>3、方式三</h3><p>编写类实现接口，在实现类接口中指定 账号和密码</p>
<blockquote>
<p>第一步：编写实现类，返回 User对象，User 对象有用户名密码和操作权限<br>第二步：创建配置类，设置使用那个 userDetailService 实现类</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 编写实现类，并指定名称</span></span><br><span class="line"><span class="meta">@Service(&quot;userDetailService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyUserDetailService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String username)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        List&lt;GrantedAuthority&gt; auths = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;ROLE_admin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;wwjj&quot;</span>, <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>().encode(<span class="string">&quot;123&quot;</span>), auths);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义实现配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfigTest</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(password());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PasswordEncoder <span class="title function_">password</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、通过数据库完成用户登录"><a href="#2、通过数据库完成用户登录" class="headerlink" title="2、通过数据库完成用户登录"></a>2、通过数据库完成用户登录</h2><blockquote>
<p>上面的三种方式在日常的开发中不实用，一般查询数据库来得到用户名和密码</p>
</blockquote>
<p>对第三种方式进行修改</p>
<h3 id="1-准备-sql"><a href="#1-准备-sql" class="headerlink" title="1 准备 sql"></a>1 准备 sql</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `users`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `users`  (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">20</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">100</span>) <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8mb4 <span class="keyword">COLLATE</span> utf8mb4_0900_ai_ci <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`) <span class="keyword">USING</span> BTREE,</span><br><span class="line">  <span class="keyword">UNIQUE</span> INDEX `username`(`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE <span class="operator">=</span> InnoDB AUTO_INCREMENT <span class="operator">=</span> <span class="number">3</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> <span class="operator">=</span> utf8mb4 <span class="keyword">COLLATE</span> <span class="operator">=</span> utf8mb4_0900_ai_ci ROW_FORMAT <span class="operator">=</span> <span class="keyword">Dynamic</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Records of users</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `users` <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;admin&#x27;</span>, <span class="string">&#x27;$2a$10$onNtpOIhtMf.4IVyecahWOGD9/1phA/I1lT4LdU9lMQrUbTyyH3n2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `users` <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;wangjian&#x27;</span>, <span class="string">&#x27;$2a$10$MVQfFUNDNTGtZQYeV1aD/el3nZ2Fq.puiDR0B8FMCe1wBYtIYJbGS&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS <span class="operator">=</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-添加依赖"><a href="#2-添加依赖" class="headerlink" title="2 添加依赖"></a>2 添加依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mybatis-plus--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-生成实体类"><a href="#3-生成实体类" class="headerlink" title="3 生成实体类"></a>3 生成实体类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wj.pojo;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Users</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-生成-Mapper-文件"><a href="#4-生成-Mapper-文件" class="headerlink" title="4 生成 Mapper 文件"></a>4 生成 Mapper 文件</h3><p>整合 MybatisPlus 制作 mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wj.mapper;</span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UsersMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;Users&gt; &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-配置数据库链接"><a href="#5-配置数据库链接" class="headerlink" title="5 配置数据库链接"></a>5 配置数据库链接</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springsecurity?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br></pre></td></tr></table></figure>

<h3 id="6-制作登录实现类"><a href="#6-制作登录实现类" class="headerlink" title="6 制作登录实现类"></a>6 制作登录实现类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Service(&quot;userDetailsService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyUserDetailsService</span> <span class="keyword">implements</span> <span class="title class_">UserDetailsService</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UsersMapper usersMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">        QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">        wrapper.eq(<span class="string">&quot;username&quot;</span>,s);</span><br><span class="line">        <span class="type">Users</span> <span class="variable">users</span> <span class="operator">=</span> usersMapper.selectOne(wrapper);</span><br><span class="line">        <span class="keyword">if</span> (users == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名不存在！&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">&quot;users:&#123;&#125;&quot;</span>,users);</span><br><span class="line">        List&lt;GrantedAuthority&gt; list = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;ROLE_admin&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(users.getUsername(),users.getPassword(),list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-添加自定义配置类"><a href="#7-添加自定义配置类" class="headerlink" title="7 添加自定义配置类"></a>7 添加自定义配置类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在配置类中添加相关的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyUserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将密码加密器加到容器中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">getPasswordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写configure配置,将我们自己的校验密码器注入到该bean中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(getPasswordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写configure配置,编写权限校验规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.formLogin()  </span><br><span class="line">                .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">                .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">                .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">                .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">                .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-引入登录页面"><a href="#8-引入登录页面" class="headerlink" title="8 引入登录页面"></a>8 引入登录页面</h3><p>将准备好的登录页面导入项目中,放入templates文件夹下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h4</span>&gt;</span>自定义登录界面<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--这个地址，需要和 配置文件中 定义的登录访问路径一致--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user/login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">    用户名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    密码：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>用户名，密码必须为 username,password 原因： 在执行登录的时候会走一个过滤器 UsernamePasswordAuthenticationFilter（可修改的）</p>
<img src="/posts/2100227203/image-20210926103629316.png" class="" title="image-20210926103629316">

<h3 id="9-编写控制器"><a href="#9-编写控制器" class="headerlink" title="9 编写控制器"></a>9 编写控制器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/login.html&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">login</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;跳转 login 登陆页面&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;login&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/fail&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fail</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;fail&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/success&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">success</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;hello Security 直接访问，不需要验证授权~~~&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello Security&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/index&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">index</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello index &quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;findAll&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;findAll&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="10-未认证请求跳转到登录页"><a href="#10-未认证请求跳转到登录页" class="headerlink" title="10 未认证请求跳转到登录页"></a>10 未认证请求跳转到登录页</h3><p>在SecurityConfig配置类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在配置类中添加相关的配置</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityConfig</span> <span class="keyword">extends</span> <span class="title class_">WebSecurityConfigurerAdapter</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyUserDetailsService userDetailsService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//将密码加密器加到容器中</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">getPasswordEncoder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BCryptPasswordEncoder</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//重写configure配置,将我们自己的校验密码器注入到该bean中</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        auth.userDetailsService(userDetailsService).passwordEncoder(getPasswordEncoder());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">////重写configure配置,编写权限校验规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        http.formLogin()    <span class="comment">// 自定义的登陆页面</span></span><br><span class="line">                .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">                .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">                .successForwardUrl(<span class="string">&quot;/success&quot;</span>).permitAll() <span class="comment">//登录成功页面</span></span><br><span class="line">                .failureForwardUrl(<span class="string">&quot;/fail&quot;</span>) <span class="comment">//登陆失败页面 </span></span><br><span class="line">                .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">                .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">                .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">                .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">                .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3、基于角色或权限进行访问控制"><a href="#3、基于角色或权限进行访问控制" class="headerlink" title="3、基于角色或权限进行访问控制"></a>3、基于角色或权限进行访问控制</h2><h3 id="1-hasAuthority-方法"><a href="#1-hasAuthority-方法" class="headerlink" title="1 hasAuthority 方法"></a>1 hasAuthority 方法</h3><p>如果当前的主体具有指定的权限(单个权限)，则返回 true,否则返回 false</p>
<ul>
<li>修改配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.formLogin()    <span class="comment">// 自定义的登陆页面</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">            .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/findAll&quot;</span>).hasAuthority(<span class="string">&quot;admin&quot;</span>) <span class="comment">//hasAuthority()，当前登录的用户，只有具有了admin权限才可以访问这个路径</span></span><br><span class="line">            .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">            .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">            .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>给用户登录主体赋予权限</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;username&quot;</span>, s);</span><br><span class="line">    <span class="type">Users</span> <span class="variable">users</span> <span class="operator">=</span> usersMapper.selectOne(wrapper);</span><br><span class="line">    <span class="keyword">if</span> (users == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;users:&#123;&#125;&quot;</span>, users);</span><br><span class="line">    List&lt;GrantedAuthority&gt; list = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">    <span class="comment">// 密码校验由 SpringSecurity 负责完成的</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(users.getUsername(), users.getPassword(), list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>添加一个控制器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/findAll&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findAll</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;findAll&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;findAll&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>测试结果：</li>
</ul>
<blockquote>
<p>先要登录，并且用户必须要admin权限才能进行访问：</p>
</blockquote>
<h3 id="2-hasAnyAuthority-方法"><a href="#2-hasAnyAuthority-方法" class="headerlink" title="2 hasAnyAuthority 方法"></a>2 hasAnyAuthority 方法</h3><p>如果当前的主体有任何提供的权限（给定的作为一个逗号分隔的字符串列表）的话，返回 true.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.formLogin()    <span class="comment">// 自定义的登陆页面</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">            .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/findAll&quot;</span>).hasAuthority(<span class="string">&quot;admin,manager&quot;</span>) <span class="comment">//hasAuthority()，当前登录的用户，只有具有了admin权限才可以访问这个路径</span></span><br><span class="line">            .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">            .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">            .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-hasRole-方法"><a href="#3-hasRole-方法" class="headerlink" title="3 hasRole 方法"></a>3 hasRole 方法</h3><p>如果用户具备给定角色就允许访问,否则出现 403。</p>
<p>如果当前主体具有指定的角色，则返回 true。</p>
<p>底层源码，默认会加上 <code>ROLE_</code> 前缀。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">hasRole</span><span class="params">(String role)</span> &#123;</span><br><span class="line">   Assert.notNull(role, <span class="string">&quot;role cannot be null&quot;</span>);</span><br><span class="line">   Assert.isTrue(!role.startsWith(<span class="string">&quot;ROLE_&quot;</span>),</span><br><span class="line">         () -&gt; <span class="string">&quot;role should not start with &#x27;ROLE_&#x27; since it is automatically inserted. Got &#x27;&quot;</span> + role + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">   <span class="keyword">return</span> <span class="string">&quot;hasRole(&#x27;ROLE_&quot;</span> + role + <span class="string">&quot;&#x27;)&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给用户添加角色：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> UserDetails <span class="title function_">loadUserByUsername</span><span class="params">(String s)</span> <span class="keyword">throws</span> UsernameNotFoundException &#123;</span><br><span class="line">    QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;username&quot;</span>, s);</span><br><span class="line">    <span class="type">Users</span> <span class="variable">users</span> <span class="operator">=</span> usersMapper.selectOne(wrapper);</span><br><span class="line">    <span class="keyword">if</span> (users == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UsernameNotFoundException</span>(<span class="string">&quot;用户名不存在！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    log.info(<span class="string">&quot;users:&#123;&#125;&quot;</span>, users);</span><br><span class="line">    List&lt;GrantedAuthority&gt; list = AuthorityUtils.commaSeparatedStringToAuthorityList(<span class="string">&quot;admin,ROLE_sale&quot;</span>);</span><br><span class="line">    <span class="comment">// 密码校验由 SpringSecurity 负责完成的</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>(users.getUsername(), users.getPassword(), list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改配置文件：</p>
<p>注意配置文件中不需要添加”ROLE_“，因为上述的底层代码会自动添加与之进行匹配。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    http.formLogin()    <span class="comment">// 自定义的登陆页面</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">            .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/findAll&quot;</span>).hasRole(<span class="string">&quot;sale&quot;</span>) <span class="comment">//hasRole()，只有具有了sale角色的才能访问该路径</span></span><br><span class="line">            .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">            .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">            .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-hasAnyRole-方法"><a href="#4-hasAnyRole-方法" class="headerlink" title="4 hasAnyRole 方法"></a>4 hasAnyRole 方法</h3><blockquote>
<p> 表示用户具备任何一个角色都可以访问。</p>
</blockquote>
<p>小结：</p>
<blockquote>
<p>hasRole,hasAuth 功能上没有任何区别，有的只是概念上的区别</p>
</blockquote>
<h2 id="4、自定义-403-没有权限的页面"><a href="#4、自定义-403-没有权限的页面" class="headerlink" title="4、自定义 403 没有权限的页面"></a>4、自定义 403 没有权限的页面</h2><h3 id="1-新建html-页面"><a href="#1-新建html-页面" class="headerlink" title="1 新建html 页面"></a>1 新建html 页面</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>unauth<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h3</span>&gt;</span>自定义无权限访问的页面<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-自定义配置文件"><a href="#2-自定义配置文件" class="headerlink" title="2 自定义配置文件"></a>2 自定义配置文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////重写configure配置,编写权限校验规则</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// 配置没有权限访问跳转自定义页面(thymeleaf 需要提供一个 controller 才能跳转)</span></span><br><span class="line">    http.exceptionHandling().accessDeniedPage(<span class="string">&quot;/unauth&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    http.formLogin()    <span class="comment">// 自定义的登陆页面</span></span><br><span class="line">            .loginPage(<span class="string">&quot;/login.html&quot;</span>)  <span class="comment">// 登陆页面是哪个</span></span><br><span class="line">            .loginProcessingUrl(<span class="string">&quot;/user/login&quot;</span>) <span class="comment">//登录访问路径，这个地址随便填写，需要和登陆页面  form 表单的提交路径一致</span></span><br><span class="line">            .defaultSuccessUrl(<span class="string">&quot;/index&quot;</span>).permitAll()  <span class="comment">// 认证成功跳转的路径</span></span><br><span class="line">            .and().authorizeRequests() <span class="comment">// 设置 哪些 url 不被保护（不需要登陆）</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;/hello&quot;</span>).permitAll()  <span class="comment">// 设置哪些路径可以直接访问，不需要认证</span></span><br><span class="line">            .antMatchers(<span class="string">&quot;/findAll&quot;</span>).hasRole(<span class="string">&quot;sale&quot;</span>) <span class="comment">//hasRole()，只有具有了sale角色的才能访问该路径</span></span><br><span class="line">            .anyRequest() <span class="comment">// 任何请求</span></span><br><span class="line">            .authenticated()  <span class="comment">// 都需要身份验证</span></span><br><span class="line">            .and().csrf().disable(); <span class="comment">//关闭cors</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-添加对应控制器"><a href="#3-添加对应控制器" class="headerlink" title="3 添加对应控制器"></a>3 添加对应控制器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/unauth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">unauth</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;unauth&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;unauth&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="六、注解使用"><a href="#六、注解使用" class="headerlink" title="六、注解使用"></a>六、注解使用</h1><h2 id="1、-Secured"><a href="#1、-Secured" class="headerlink" title="1、@Secured()"></a>1、@Secured()</h2><p><code>先开启注解功能</code>：@EnableGlobalMethodSecurity(securedEnabled= true)</p>
<p>判断是否具有角色，另外需要注意的是这里匹配的字符串需要添加前缀<code>“ROLE_“</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.wj.mapper&quot;)</span> </span><br><span class="line"><span class="meta">@EnableGlobalMethodSecurity(securedEnabled = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringSecurity03Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringSecurity03Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在控制器方法上添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testSecured&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="meta">@Secured(&#123;&quot;ROLE_normal&quot;,&quot;ROLE_sale&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testSecured</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;testSecured&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;testSecured&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2、-PreAuthorize"><a href="#2、-PreAuthorize" class="headerlink" title="2、@PreAuthorize"></a>2、@PreAuthorize</h2><p><code>先开启注解功能</code>：@EnableGlobalMethodSecurity(prePostEnabled = true)</p>
<p>@PreAuthorize：注解适合进入方法前的<code>权限</code>验证， @PreAuthorize 可以将登录用户的 roles/permissions 参数传到方法中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testPreAuthorize&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasAnyAuthority(&#x27;menu:system&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPreAuthorize</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;PreAuthorize&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello PreAuthorize&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/testPreAuthorize1&quot;)</span></span><br><span class="line"><span class="meta">@PreAuthorize(&quot;hasRole(&#x27;ROLE_普通用户&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">testPreAuthorize1</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;PreAuthorize1&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello PreAuthorize1&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试结果：</p>
<p>wangjian:只有‘’普通用户‘’角色，能访问/testPreAuthorize1；只有menu:user权限，不能访问/testPreAuthorize</p>
<p>Admin:只有‘’管理员‘’角色，不能访问/testPreAuthorize1；有menu:system权限，能访问/testPreAuthorize</p>
</blockquote>
<h2 id="3、-PostAuthorize"><a href="#3、-PostAuthorize" class="headerlink" title="3、@PostAuthorize"></a>3、@PostAuthorize</h2><p><code>先开启注解功能</code>：@EnableGlobalMethodSecurity(prePostEnabled = true)</p>
<p>@PostAuthorize 注解使用并不多，在方法执行后再进行权限验证，适合验证带有返回值的权限.</p>
<p><strong>进入方法后，对出参数进行校验权限</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/testPostAuthorize&quot;)</span></span><br><span class="line"><span class="meta">@PostAuthorize(&quot;hasAnyAuthority(&#x27;menu:system&#x27;)&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">preAuthorize</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;test--PostAuthorize&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;PostAuthorize&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>测试结果：</p>
<p>wangjian:只有menu:user权限，不能访问/testPostAuthorize，会打印test–PostAuthorize</p>
<p>Admin:有menu:system权限，能访问/testPostAuthorize，会打印test–PostAuthorize</p>
</blockquote>
<h2 id="4、-PostFilter"><a href="#4、-PostFilter" class="headerlink" title="4、@PostFilter"></a>4、@PostFilter</h2><p>@PostFilter ：权限验证之后对数据进行过滤 留下用户名是 admin1 的数据</p>
<h1 id="七、SpringSecurity-其他配置"><a href="#七、SpringSecurity-其他配置" class="headerlink" title="七、SpringSecurity 其他配置"></a>七、SpringSecurity 其他配置</h1><h2 id="1、基于数据库的记住我"><a href="#1、基于数据库的记住我" class="headerlink" title="1、基于数据库的记住我"></a>1、基于数据库的记住我</h2><img src="/posts/2100227203/1847837-20210508111129882-1783314242.png" class="" title="img">

<h3 id="1-创建表"><a href="#1-创建表" class="headerlink" title="1 创建表"></a>1 创建表</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> persistent_logins (</span><br><span class="line"> username <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> series <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> token <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line"> last_used <span class="type">timestamp</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span></span><br><span class="line"><span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line"> <span class="keyword">PRIMARY</span> KEY (series)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure>

<h3 id="2编写配置类"><a href="#2编写配置类" class="headerlink" title="2编写配置类"></a>2编写配置类</h3><p>创建配置类:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BrowserSecurityConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="comment">//注入操作的类PersistentTokenRepository</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PersistentTokenRepository <span class="title function_">getPersistentTokenRepository</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">jdbcTokenRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();</span><br><span class="line">        <span class="comment">// 赋值数据源</span></span><br><span class="line">        jdbcTokenRepository.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span>  jdbcTokenRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3修改安全配置类"><a href="#3修改安全配置类" class="headerlink" title="3修改安全配置类"></a>3修改安全配置类</h3><p>在配置类SecurityConfiger中加入：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> PersistentTokenRepository persistentTokenRepository;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启记住我功能</span></span><br><span class="line">http.rememberMe()</span><br><span class="line">    .tokenValiditySeconds(<span class="number">60</span>) <span class="comment">//过期时间,单位是秒</span></span><br><span class="line">    .tokenRepository(persistentTokenRepository) <span class="comment">//令牌操作类</span></span><br><span class="line">    .userDetailsService(myUsersDetailService); <span class="comment">//用户信息查询类</span></span><br></pre></td></tr></table></figure>

<h3 id="4页面添加记住我复选框"><a href="#4页面添加记住我复选框" class="headerlink" title="4页面添加记住我复选框"></a>4页面添加记住我复选框</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">记住我：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span><span class="attr">name</span>=<span class="string">&quot;remember-me&quot;</span><span class="attr">title</span>=<span class="string">&quot;记住密码&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5设置有效期"><a href="#5设置有效期" class="headerlink" title="5设置有效期"></a>5设置有效期</h3><p>默认 2 周时间。但是可以通过设置状态有效时间，即使项目重新启动下次也可以正常登 录。</p>
<p>在配置文件SecurityConfiger中设置:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开启记住我功能</span></span><br><span class="line">http.rememberMe()</span><br><span class="line">    .tokenValiditySeconds(<span class="number">60</span>) <span class="comment">//过期时间,单位是秒</span></span><br><span class="line">    .tokenRepository(persistentTokenRepository) <span class="comment">//令牌操作类</span></span><br><span class="line">    .userDetailsService(myUsersDetailService); <span class="comment">//用户信息查询类</span></span><br></pre></td></tr></table></figure>

<h2 id="2、Session-超时设置"><a href="#2、Session-超时设置" class="headerlink" title="2、Session 超时设置"></a>2、Session 超时设置</h2><h2 id="3、限制用户最大登录数"><a href="#3、限制用户最大登录数" class="headerlink" title="3、限制用户最大登录数"></a>3、限制用户最大登录数</h2><h2 id="4、用户注销"><a href="#4、用户注销" class="headerlink" title="4、用户注销"></a>4、用户注销</h2><h3 id="1-在登录页面添加一个退出连接"><a href="#1-在登录页面添加一个退出连接" class="headerlink" title="1 在登录页面添加一个退出连接"></a>1 在登录页面添加一个退出连接</h3><p>success.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>success<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>自定义，登录成功界面~<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/logout&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-在配置类中添加退出映射地址"><a href="#2-在配置类中添加退出映射地址" class="headerlink" title="2 在配置类中添加退出映射地址"></a>2 在配置类中添加退出映射地址</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//退出</span></span><br><span class="line">http.logout()</span><br><span class="line">    .logoutUrl(<span class="string">&quot;/logout&quot;</span>) <span class="comment">//退出的请求</span></span><br><span class="line">    .logoutSuccessUrl(<span class="string">&quot;/loginPage&quot;</span>).permitAll(); <span class="comment">//退出成功之后跳转的页面</span></span><br></pre></td></tr></table></figure>

<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3 测试"></a>3 测试</h3><p>退出之后，是无法访问需要登录时才能访问的控制器！</p>
<h1 id="八、SpringSecurity-原理总结"><a href="#八、SpringSecurity-原理总结" class="headerlink" title="八、SpringSecurity 原理总结"></a>八、SpringSecurity 原理总结</h1><h2 id="1、SpringSecurity-本质"><a href="#1、SpringSecurity-本质" class="headerlink" title="1、SpringSecurity 本质"></a>1、SpringSecurity 本质</h2><p>SpringSecurity 的本质是一个过滤器链，从启动日志中 是可以获取到过滤器链：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">2021-09-25</span> <span class="string">16:05:45.276  INFO 8868 --- [           main] o.s.s.web.DefaultSecurityFilterChain     : Will secure any request with [</span></span><br><span class="line"><span class="attr">org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.context.SecurityContextPersistenceFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.header.HeaderWriterFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.csrf.CsrfFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.logout.LogoutFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.www.BasicAuthenticationFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.savedrequest.RequestCacheAwareFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.authentication.AnonymousAuthenticationFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.session.SessionManagementFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.access.ExceptionTranslationFilter,</span> <span class="string"></span></span><br><span class="line"><span class="attr">org.springframework.security.web.access.intercept.FilterSecurityInterceptor</span></span><br><span class="line"><span class="attr">]</span></span><br></pre></td></tr></table></figure>



<p>代码底层流程：</p>
<p>重点看三个过滤器：</p>
<p><strong>FilterSecurityInterceptor</strong>:：是一个方法级的权限过滤器, 基本位于过滤链的最底部</p>
<p><strong>ExceptionTranslationFilter</strong>:：是个异常过滤器，用来处理在认证授权过程中抛出的异常</p>
<p><strong>UsernamePasswordAuthenticationFilter</strong> ：对/login 的 POST 请求做拦截，校验表单中用户 名，密码。</p>
<h2 id="1、SpringSecurity-的过滤器介绍"><a href="#1、SpringSecurity-的过滤器介绍" class="headerlink" title="1、SpringSecurity 的过滤器介绍"></a>1、SpringSecurity 的过滤器介绍</h2><p>SpringSecurity 采用的是责任链的设计模式，它有一条很长的过滤器链。现在对这条过滤 器链的 15 个过滤器进行说明:</p>
<ol>
<li>WebAsyncManagerIntegrationFilter：将 Security 上下文与 Spring Web 中用于 处理异步请求映射的 WebAsyncManager 进行集成。</li>
<li> SecurityContextPersistenceFilter：在每次请求处理之前将该请求相关的安全上 下文信息加载到 SecurityContextHolder 中，然后在该次请求处理完成之后，将 SecurityContextHolder 中关于这次请求的信息存储到一个“仓储”中，然后将 SecurityContextHolder 中的信息清除，例如在 Session 中维护一个用户的安全信 息就是这个过滤器处理的。</li>
<li> HeaderWriterFilter：用于将头信息加入响应中。</li>
<li>CsrfFilter：用于处理跨站请求伪造。</li>
<li>LogoutFilter：用于处理退出登录。</li>
<li>UsernamePasswordAuthenticationFilter：用于处理基于表单的登录请求，从表单中 获取用户名和密码。默认情况下处理来自 /login 的请求。从表单中获取用户名和密码 时，默认使用的表单 name 值为 username 和 password，这两个值可以通过设置这个 过滤器的 usernameParameter 和 passwordParameter 两个参数的值进行修改。</li>
<li>DefaultLoginPageGeneratingFilter：如果没有配置登录页面，那系统初始化时就会 配置这个过滤器，并且用于在需要进行登录时生成一个登录表单页面。</li>
<li>BasicAuthenticationFilter：检测和处理 http basic 认证。</li>
<li>RequestCacheAwareFilter：用来处理请求的缓存。</li>
<li>SecurityContextHolderAwareRequestFilter：主要是包装请求对象 request。</li>
<li>AnonymousAuthenticationFilter：检测 SecurityContextHolder 中是否存在 Authentication 对象，如果不存在为其提供一个匿名 Authentication。</li>
<li>SessionManagementFilter：管理 session 的过滤器</li>
<li>ExceptionTranslationFilter：处理 AccessDeniedException 和 AuthenticationException 异常。</li>
<li>FilterSecurityInterceptor：可以看做过滤器链的出口。</li>
<li>RememberMeAuthenticationFilter：当用户没有登录而直接访问资源时, 从 cookie 里找出用户的信息, 如果 Spring Security 能够识别出用户提供的remember me cookie, 用户将不必填写用户名和密码, 而是直接登录进入系统，该过滤器默认不开启。</li>
</ol>
<h2 id="2、SpringSecurity-基本流程"><a href="#2、SpringSecurity-基本流程" class="headerlink" title="2、SpringSecurity 基本流程"></a>2、SpringSecurity 基本流程</h2><p><strong>Spring Security</strong> 采取过滤链实现认证与授权，只有当前过滤器通过，才能进入下一个 过滤器：</p>
<img src="/posts/2100227203/1847837-20210508111907557-472521407.png" class="" title="img">

<p>绿色部分是认证过滤器，需要我们自己配置，可以配置多个认证过滤器。认证过滤器可以 使用 Spring Security 提供的认证过滤器，也可以自定义过滤器（例如：短信验证）。认证过滤器要在 configure(HttpSecurity http)方法中配置，没有配置不生效。下面会重点介绍以下三个过滤器：</p>
<blockquote>
<p><strong>UsernamePasswordAuthenticationFilter</strong> 过滤器：该过滤器会拦截前端提交的 POST 方式 的登录表单请求，并进行身份认证。</p>
<p><strong>ExceptionTranslationFilter</strong> 过滤器：该过滤器不需要我们配置，对于前端提交的请求会直接放行，捕获后续抛出的异常并进行处理(例如：权限访问限制)</p>
<p><strong>FilterSecurityInterceptor</strong> 过滤器：该过滤器是过滤器链的最后一个过滤器，根据资源权限配置来判断当前请求是否有权限访问对应的资源。如果访问受限会抛出相关异常，并由 ExceptionTranslationFilter 过滤器进行捕获和处理。</p>
</blockquote>
<h2 id="3、SpringSecurity-认证流程"><a href="#3、SpringSecurity-认证流程" class="headerlink" title="3、SpringSecurity 认证流程"></a>3、SpringSecurity 认证流程</h2><p>认证流程是在 <strong>UsernamePasswordAuthenticationFilter</strong> 过滤器中处理的，具体流程如下 所示：</p>
<img src="/posts/2100227203/1847837-20210508112016082-1690527735.png" class="" title="img">


</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://ericwjian.github.io">Eric</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://ericwjian.github.io/posts/2100227203/">https://ericwjian.github.io/posts/2100227203/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://ericwjian.github.io" target="_blank">Eric</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/SpringSecurity/">SpringSecurity</a></div><div class="post_share"><div class="social-share" data-image="/img/avatar.jpg" data-sites="wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3993220350/" title="Shiro"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Shiro</div></div></a></div><div class="next-post pull-right"><a href="/posts/3017659836/" title="JWT"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JWT</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Eric</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">140</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">98</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">31</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://gitee.com/wangjian_uuid" target="_blank" title="Gitee"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:358070983@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=358070983&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fa-brands fa-qq"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B"><span class="toc-text">一、框架简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E8%A6%81"><span class="toc-text">1、概要</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E5%90%8C%E6%AC%BE%E4%BA%A7%E5%93%81%E5%AF%B9%E6%AF%94"><span class="toc-text">2、同款产品对比</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Spring-Security"><span class="toc-text">1.Spring Security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Shiro"><span class="toc-text">2.Shiro</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%9D%83%E9%99%90%E7%AE%A1%E7%90%86%E4%B8%AD%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">3、权限管理中的相关概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%BB%E4%BD%93"><span class="toc-text">1.主体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%AE%A4%E8%AF%81"><span class="toc-text">2.认证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%8E%88%E6%9D%83"><span class="toc-text">3.授权</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E5%85%A5%E9%97%A8%E6%A1%88%E4%BE%8B"><span class="toc-text">二、入门案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81POM-%E6%96%87%E4%BB%B6"><span class="toc-text">1、POM 文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81controller"><span class="toc-text">2、controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">3、测试</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E4%B8%A4%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-text">三、两个重要的接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81UserDetailsService"><span class="toc-text">1、UserDetailsService</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81PasswordEncoder"><span class="toc-text">2、PasswordEncoder</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%9B%E3%80%81SecurityConfig-%E9%85%8D%E7%BD%AE"><span class="toc-text">四、SecurityConfig 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81HttpSecurity%E9%85%8D%E7%BD%AE%E5%88%97%E8%A1%A8"><span class="toc-text">1、HttpSecurity配置列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81authorizeRequests-%E5%AF%B9url%E8%BF%9B%E8%A1%8C%E6%8E%A7%E5%88%B6"><span class="toc-text">2、authorizeRequests() 对url进行控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E7%99%BB%E5%BD%95"><span class="toc-text">3、登录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%80%80%E5%87%BA"><span class="toc-text">4、退出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E8%87%AA%E5%AE%9A-403-%E6%97%A0%E6%9D%83%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="toc-text">5、自定 403 无权访问规则</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%94%E3%80%81Web-%E6%9D%83%E9%99%90%E6%96%B9%E6%A1%88"><span class="toc-text">五、Web 权限方案</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E8%AE%BE%E7%BD%AE%E8%B4%A6%E5%8F%B7%E3%80%81%E5%AF%86%E7%A0%81"><span class="toc-text">1、设置账号、密码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%96%B9%E5%BC%8F%E4%B8%80"><span class="toc-text">1、方式一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%B9%E5%BC%8F%E4%BA%8C"><span class="toc-text">2、方式二</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%96%B9%E5%BC%8F%E4%B8%89"><span class="toc-text">3、方式三</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E9%80%9A%E8%BF%87%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%8C%E6%88%90%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95"><span class="toc-text">2、通过数据库完成用户登录</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%87%86%E5%A4%87-sql"><span class="toc-text">1 准备 sql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%B7%BB%E5%8A%A0%E4%BE%9D%E8%B5%96"><span class="toc-text">2 添加依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%94%9F%E6%88%90%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">3 生成实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%94%9F%E6%88%90-Mapper-%E6%96%87%E4%BB%B6"><span class="toc-text">4 生成 Mapper 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E9%93%BE%E6%8E%A5"><span class="toc-text">5 配置数据库链接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%88%B6%E4%BD%9C%E7%99%BB%E5%BD%95%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-text">6 制作登录实现类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-%E6%B7%BB%E5%8A%A0%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">7 添加自定义配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-%E5%BC%95%E5%85%A5%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-text">8 引入登录页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-%E7%BC%96%E5%86%99%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">9 编写控制器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-%E6%9C%AA%E8%AE%A4%E8%AF%81%E8%AF%B7%E6%B1%82%E8%B7%B3%E8%BD%AC%E5%88%B0%E7%99%BB%E5%BD%95%E9%A1%B5"><span class="toc-text">10 未认证请求跳转到登录页</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%9F%BA%E4%BA%8E%E8%A7%92%E8%89%B2%E6%88%96%E6%9D%83%E9%99%90%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-text">3、基于角色或权限进行访问控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-hasAuthority-%E6%96%B9%E6%B3%95"><span class="toc-text">1 hasAuthority 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-hasAnyAuthority-%E6%96%B9%E6%B3%95"><span class="toc-text">2 hasAnyAuthority 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-hasRole-%E6%96%B9%E6%B3%95"><span class="toc-text">3 hasRole 方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-hasAnyRole-%E6%96%B9%E6%B3%95"><span class="toc-text">4 hasAnyRole 方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89-403-%E6%B2%A1%E6%9C%89%E6%9D%83%E9%99%90%E7%9A%84%E9%A1%B5%E9%9D%A2"><span class="toc-text">4、自定义 403 没有权限的页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%96%B0%E5%BB%BAhtml-%E9%A1%B5%E9%9D%A2"><span class="toc-text">1 新建html 页面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">2 自定义配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B7%BB%E5%8A%A0%E5%AF%B9%E5%BA%94%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="toc-text">3 添加对应控制器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8"><span class="toc-text">六、注解使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81-Secured"><span class="toc-text">1、@Secured()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81-PreAuthorize"><span class="toc-text">2、@PreAuthorize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81-PostAuthorize"><span class="toc-text">3、@PostAuthorize</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81-PostFilter"><span class="toc-text">4、@PostFilter</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%83%E3%80%81SpringSecurity-%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE"><span class="toc-text">七、SpringSecurity 其他配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%9F%BA%E4%BA%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%B0%E4%BD%8F%E6%88%91"><span class="toc-text">1、基于数据库的记住我</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-text">1 创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">2编写配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E4%BF%AE%E6%94%B9%E5%AE%89%E5%85%A8%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-text">3修改安全配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E9%A1%B5%E9%9D%A2%E6%B7%BB%E5%8A%A0%E8%AE%B0%E4%BD%8F%E6%88%91%E5%A4%8D%E9%80%89%E6%A1%86"><span class="toc-text">4页面添加记住我复选框</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E8%AE%BE%E7%BD%AE%E6%9C%89%E6%95%88%E6%9C%9F"><span class="toc-text">5设置有效期</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81Session-%E8%B6%85%E6%97%B6%E8%AE%BE%E7%BD%AE"><span class="toc-text">2、Session 超时设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%99%90%E5%88%B6%E7%94%A8%E6%88%B7%E6%9C%80%E5%A4%A7%E7%99%BB%E5%BD%95%E6%95%B0"><span class="toc-text">3、限制用户最大登录数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E7%94%A8%E6%88%B7%E6%B3%A8%E9%94%80"><span class="toc-text">4、用户注销</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%9C%A8%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%80%80%E5%87%BA%E8%BF%9E%E6%8E%A5"><span class="toc-text">1 在登录页面添加一个退出连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%9C%A8%E9%85%8D%E7%BD%AE%E7%B1%BB%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%80%80%E5%87%BA%E6%98%A0%E5%B0%84%E5%9C%B0%E5%9D%80"><span class="toc-text">2 在配置类中添加退出映射地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E6%B5%8B%E8%AF%95"><span class="toc-text">3 测试</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%AB%E3%80%81SpringSecurity-%E5%8E%9F%E7%90%86%E6%80%BB%E7%BB%93"><span class="toc-text">八、SpringSecurity 原理总结</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81SpringSecurity-%E6%9C%AC%E8%B4%A8"><span class="toc-text">1、SpringSecurity 本质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81SpringSecurity-%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、SpringSecurity 的过滤器介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81SpringSecurity-%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-text">2、SpringSecurity 基本流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81SpringSecurity-%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B"><span class="toc-text">3、SpringSecurity 认证流程</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3346148432/" title="MyBatis 拦截器">MyBatis 拦截器</a><time datetime="2024-09-18T16:00:00.000Z" title="发表于 2024-09-19 00:00:00">2024-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3346148434/" title="MyBatis 集成druid数据源">MyBatis 集成druid数据源</a><time datetime="2024-09-18T16:00:00.000Z" title="发表于 2024-09-19 00:00:00">2024-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/1166366203/" title="SQL调优">SQL调优</a><time datetime="2024-07-16T16:00:00.000Z" title="发表于 2024-07-17 00:00:00">2024-07-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/3109398172/" title="ContextHolder">ContextHolder</a><time datetime="2024-07-11T16:00:00.000Z" title="发表于 2024-07-12 00:00:00">2024-07-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2889834893/" title="SpringCloud Feign">SpringCloud Feign</a><time datetime="2024-07-01T16:00:00.000Z" title="发表于 2024-07-02 00:00:00">2024-07-02</time></div></div></div></div></div></div></main><footer id="footer" style="background: #47577e"><div id="footer-wrap"><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to my blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '2N3fEF3CzNAzKwVbFlhSTUuM-gzGzoHsz',
      appKey: '9m41Klhi8IgsrNrbyMnoCHrN',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>